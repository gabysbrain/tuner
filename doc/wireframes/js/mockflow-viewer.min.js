var COMPANYID="";var currentOpenPage="";var DEFAULTFONT="Arial";var ZOOMX=100;var FITX=false;var MOBILE=false;var ANNOTATIONS=new Array();var LINKED=new Array();function cleanMockupCanvas(){PagePool.clean();ANNOTATIONS=new Array();LINKED=new Array();COMPANYID="";currentOpenPage="";DEFAULTFONT="Arial";ZOOMX=100;FITX=false;currentPage=null;$("#mockupMap").html("")}function getData(b,d,c,a){COMPANYID=d;$.post("getMockupData.jsp",{mockupid:b,clientid:d,keyid:c,pid:a},function(e){e=jQuery.trim(e);if(e=="fail"){alert("Permission Denied");return}else{xmlParser(e)}});return}var treeLoaded=false;function htmlspecialchars(a){if(typeof(a)=="string"){a=a.replace(/&/g,"&amp;");a=a.replace(/"/g,"&quot;");a=a.replace(/'/g,"&#039;");a=a.replace(/</g,"&lt;");a=a.replace(/>/g,"&gt;")}return a}function htmlspecialchars_reverse(a){if(typeof(a)=="string"){a=a.replace(/&gt;/ig,">");a=a.replace(/&lt;/ig,"<");a=a.replace(/&#039;/g,"'");a=a.replace(/&quot;/ig,'"');a=a.replace(/&amp;/ig,"&")}return a}function xmlParser(c){if(COMPANYID==null||COMPANYID=="null"||COMPANYID==""){var a=c.split("#companyid#");if(a.length==2){COMPANYID=a[0];c=a[1]}}var e=$(c).attr("font");if(e!=""&&e!="MockFlowFont"&&e!=undefined){DEFAULTFONT=e}$(c).find("component[type='Page']").each(function(){var f=$("<div/>").append($(this).clone()).html();var g=$(f);var h=new Page();h.e2xml.settingsXML=g;h.parentPage=g.attr("parent");h.masterPage=g.attr("master");h.eid=g.attr("eid");h.pageName=htmlspecialchars(g.attr("name"));if(g.attr("folder")=="true"){h.folder=true}h.e2xml.applySettings();if(h.e2xml.settings.properties.navHide!=null){h.navHide=h.e2xml.settings.properties.navHide}PagePool.addPage(h)});PagePool.mapPages();var b=PagePool.getMap();$("#mockupMap").empty();$("#mockupMap").append(b);$("#mfsitemap").kendoTreeView();var d=$("#mfsitemap").data("kendoTreeView");d.expand(".k-item");d.bind("select",function(f){var g=PagePool.getPage(PagePool.getRevPageMap()[f.node.id]);if(g){if(!g.navHide){viewPage(g)}}else{alert("Page does not exist")}if(MOBILE){$("#sitemap").text("Site Map");$("#mockupContentHolder").css({display:"block"});$("#mockupMap").css({display:"none"})}});$("#mockupContent").mouseover(function(){if(pageloaded){if($("#linkhighlights").prop("checked")==true){toggleLinkHighlights(true)}}});$("#mockupContent").mouseout(function(){if(pageloaded){if($("#linkhighlights").prop("checked")==true){toggleLinkHighlights(false)}}});if(PUBLICPAGE!=""&&PUBLICPAGE!=null){if(PagePool.getPage(PUBLICPAGE)){viewPage(checkPage(PagePool.getPage(PUBLICPAGE)))}else{viewPage(checkPage(PagePool.getPages()[0]))}}else{viewPage(checkPage(PagePool.getPages()[0]))}}function checkPage(b){if(b.navHide||b.folder){for(var a=0;a<PagePool.getPages().length;a++){var c=PagePool.getPages()[a];if(!c.navHide&&!c.folder){return c}}return b}else{return b}}var currentPage;var highestWidth=0;var highestHeight=0;var pageloaded=false;function viewPage(b){if(b!=currentPage&&!b.folder){highestWidth=0;highestHeight=0;pageloaded=false;ANNOTATIONS=new Array();LINKED=new Array();$("#mockupContent").empty();try{$.address.value("page="+b.eid)}catch(a){}loadPage(b);addLinkHiglights();if($("#annotations").prop("checked")==false){toggleAnnotations(false)}if($("#annotations").prop("checked")==true){toggleAnnotations(true)}if($("#linkhighlights").prop("checked")==false){toggleLinkHighlights(false)}if($("#linkhighlights").prop("checked")==true){toggleLinkHighlights(true)}$("#mockupContent").height(highestHeight+25);$("#mockupContent").width(highestWidth+25);pageloaded=true;if(FITX){zoomToFit()}else{$("#mockupContent").css("zoom",ZOOMX+"%")}if(MOBILE){$(window).resize()}}}function loadPage(b){if(!b.folder){if(b.masterPage&&b.masterPage!=""&&PagePool.getPage(b.masterPage)!=null){loadPage(PagePool.getPage(b.masterPage))}var a=b.e2xml.settingsXML;currentPage=b;$(a).find("group").each(function(){var c=$("<div/>").append($(this).clone()).html();var d=$(c);if(d){var e=d.attr("gid");var f=d.attr("link");if(e!=""&&f!=""){b.linkedGroups[e]=f}}});$(a).find("children").each(function(){var c=$("<div/>").append($(this).clone());c.find("component").each(function(){getComponent($(this),b)})})}}function getComponent(c,d){var a=null;if(c.attr("type")=="Circle"){a=new PCircle()}if(c.attr("type")=="Container"){a=new PContainer()}if(c.attr("type")=="WedgeBar"){a=new PWedgeBar()}if(c.attr("type")=="AreaChart"){a=new PAreaChart()}if(c.attr("type")=="LineChart"){a=new PLineChart()}if(c.attr("type")=="CheckboxGroup"){a=new CheckboxGroup()}if(c.attr("type")=="RadiobuttonGroup"){a=new RadiobuttonGroup()}if(c.attr("type")=="List"){a=new PList()}if(c.attr("type")=="BarChart"){a=new PBarChart()}if(c.attr("type")=="Browser"){a=new PBrowser()}if(c.attr("type")=="TextEditor"){a=new PTextEditor()}if(c.attr("type")=="PlotChart"){a=new PPlotChart()}if(c.attr("type")=="AlertBox"){a=new PAlertBox()}if(c.attr("type")=="BubbleChart"){a=new PBubbleChart()}if(c.attr("type")=="TabBar"){a=new PTabBar()}if(c.attr("type")=="Tree"){a=new PTree()}if(c.attr("type")=="BulletList"){a=new PBulletList()}if(c.attr("type")=="PieChart"){a=new PPieChart()}if(c.attr("type")=="ColumnChart"){a=new PColumnChart()}if(c.attr("type")=="DataGrid"){a=new PDataGrid()}if(c.attr("type")=="ToolTip"){a=new PToolTip()}if(c.attr("type")=="Map"){a=new PMap()}if(c.attr("type")=="Stamp"){a=new Stamp()}if(c.attr("type")=="Gauge"){a=new Gauge()}if(c.attr("type")=="Ruler"){a=new PRuler()}if(c.attr("type")=="VRuler"){a=new VRuler()}if(c.attr("type")=="Window"){a=new PWindow()}if(c.attr("type")=="Accordion"){a=new PAccordion()}if(c.attr("type")=="TabNavigator"){a=new PTabNavigator()}if(c.attr("type")=="Label"){a=new PLabel()}if(c.attr("type")=="Triangle"){a=new PTriangle()}if(c.attr("type")=="Pagination"){a=new PPagination()}if(c.attr("type")=="AlphaNumericLinks"){a=new AlphaNumericLinks()}if(c.attr("type")=="ComboBox"){a=new PComboBox()}if(c.attr("type")=="Spinner"){a=new PSpinner()}if(c.attr("type")=="TextInput"){a=new PTextInput()}if(c.attr("type")=="TextArea"){a=new PTextArea()}if(c.attr("type")=="Note"){a=new PNote()}if(c.attr("type")=="HDivider"){a=new HDivider()}if(c.attr("type")=="VDivider"){a=new VDivider()}if(c.attr("type")=="ProgressBar"){a=new PProgressBar()}if(c.attr("type")=="Greeking"){a=new Greeking()}if(c.attr("type")=="ColorPicker"){a=new PColorPicker()}if(c.attr("type")=="Captcha"){a=new PCaptcha()}if(c.attr("type")=="CheckBox"){a=new PCheckBox()}if(c.attr("type")=="Text"){a=new PText()}if(c.attr("type")=="BlockText"){a=new PBlockText()}if(c.attr("type")=="HBracket"){a=new HBracket()}if(c.attr("type")=="VBracket"){a=new VBracket()}if(c.attr("type")=="TagCloud"){a=new PTagCloud()}if(c.attr("type")=="RoundedRectangle"){a=new PRoundedRectangle()}if(c.attr("type")=="HotSpot"){a=new PHotSpot()}if(c.attr("type")=="Icon"){a=new PIcon()}if(c.attr("type")=="Image"){a=new PImage()}if(c.attr("type")=="Button"){a=new PButton()}if(c.attr("type")=="Panel"){a=new PPanel()}if(c.attr("type")=="DateInput"){a=new PDateInput()}if(c.attr("type")=="Group"){a=new PGroupContainer()}if(c.attr("type")=="MenuBar"){a=new PMenuBar()}if(c.attr("type")=="TitleBox"){a=new PTitleBox()}if(c.attr("type")=="RadioButton"){a=new PRadioButton()}if(c.attr("type")=="Arrow"){a=new PArrow()}if(c.attr("type")=="CoverFlow"){a=new PCoverFlow()}if(c.attr("type")=="Rating"){a=new PRating()}if(c.attr("type")=="Callout"){a=new PCallout()}if(c.attr("type")=="LinkBar"){a=new PLinkBar()}if(c.attr("type")=="BreadCrumb"){a=new PBreadCrumb()}if(c.attr("type")=="Banner"){a=new PBanner()}if(c.attr("type")=="Layout"){a=new PLayout()}if(c.attr("type")=="Calendar"){a=new PCalendar()}if(c.attr("type")=="ButtonBar"){a=new PButtonBar()}if(c.attr("type")=="VerticalButtonBar"){a=new PVerticalButtonBar()}if(c.attr("type")=="HScrollBar"){a=new HScrollBar()}if(c.attr("type")=="VScrollBar"){a=new VScrollBar()}if(c.attr("type")=="Webcam"){a=new PWebcam()}if(c.attr("type")=="VideoPlayer"){a=new PVideoPlayer()}if(c.attr("type")=="HorizontalSlider"){a=new PHorizontalSlider()}if(c.attr("type")=="VerticalSlider"){a=new PVerticalSlider()}if(c.attr("type")=="SearchBox"){a=new PSearchBox()}if(a!=null){a.eid="cmp"+guidGenerator();a.x=parseFloat(c.attr("x"));a.y=parseFloat(c.attr("y"));if(c.attr("groupid")!=""&&c.attr("groupid")!=null){a.GROUPID=c.attr("groupid")}if(MOBILE){a.y=a.y+50}a.width=parseFloat(c.attr("w"));a.height=parseFloat(c.attr("h"));try{if((a.x+a.width)>highestWidth){highestWidth=a.x+a.width}if((a.y+a.height)>highestHeight){highestHeight=a.y+a.height}}catch(b){}a.page=d;a.e2xml.settingsXML=c;if(a.ANNOTATION){ANNOTATIONS[ANNOTATIONS.length]=a}addComponent(a,d)}}function addComponent(a,b){a.e2xml.applySettings();a.render()}function toggleAnnotations(c){for(var b=0;b<=ANNOTATIONS.length-1;b++){var a=ANNOTATIONS[b];if(c){if(a.NAME=="Note"){if($("#"+a.eid+"arr").length>0){$("#"+a.eid+"arr").show()}}if($("#"+a.eid).length>0){$("#"+a.eid).show()}}else{if(a.NAME=="Note"){if($("#"+a.eid+"arr").length>0){$("#"+a.eid+"arr").hide()}}if($("#"+a.eid).length>0){$("#"+a.eid).hide()}}}}function toggleLinkHighlights(a){if(a){$(".mfcomplinked").show()}else{$(".mfcomplinked").hide()}}function guidGenerator(){var a=function(){return(((1+Math.random())*65536)|0).toString(16).substring(1)};return(a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a())}var PagePool=(function(){var b=new Array();var c=new Array();var a=new Object();var f=new Array();var e="";function d(){}return{addPage:function(g){b[b.length]=g},clean:function(g){b=new Array();b=new Array();c=new Array();f=new Array();e=""},mapPages:function(){var m=new Object();for(var h=0;h<b.length;h++){var l=b[h];c[l.eid]="p"+h;a["p"+h]=l.eid;m[l.eid]=l}for(var k=0;k<b.length;k++){var l=b[k];if(c[l.parentPage]){var g=m[l.parentPage];if(g&&g.parentPage!=l.eid){g.children.push(l)}else{l.parentPage="";f.push(l)}}else{f.push(l)}}e="<ul id='mfsitemap' style='color: #FFFFFF;'>";if(f.length>0){e=formSiteMap(e,f)}e=e+"</ul>"},getPages:function(){return b},getPageMap:function(){return c},getRevPageMap:function(){return a},getMap:function(){return e},getPage:function(g){for(var h=0;h<b.length;h++){var j=b[h];if(j.eid==g){return j}}return null}}})();function formSiteMap(d,b){for(var c=0;c<b.length;c++){var e=b[c];var a=e.navHide;var f=false;if(e.parentPage&&e.parentPage!=""&&PagePool.getPage(e.parentPage)!=null){f=true;d=d+'<li eid="'+e.eid+'" id="'+PagePool.getPageMap()[e.eid]+'" parent_id="'+PagePool.getPageMap()[e.parentPage]+'" rel="file" >'}else{d=d+'<li eid="'+e.eid+'" id="'+PagePool.getPageMap()[e.eid]+'" parent_id="0"  rel="file"  >'}if(f){a=false}if(a){if(e.folder){d=d+'<img src="./assets/folder.png"/>'+e.pageName+""}else{d=d+' <img src="./assets/page.png" /><font style="color: #33333; font-style:italic; text-decoration: line-through;" >'+e.pageName+"</font>"}}else{if(e.folder){d=d+'<img src="./assets/folder.png" />'+e.pageName+""}else{d=d+'<img src="./assets/page.png" />'+e.pageName+""}}if(e.children.length>0){d=d+"<ul>";d=formSiteMap(d,e.children);d=d+"</ul>"}d=d+"</li>"}return d}function ComponentSettings(a){this.propertiesXML=new Array();this.stylesXML=new Array();this.properties=new Array();this.styles=new Array();this.component=a;this.effects=new Array();this.typeConverter=function(d,b){var c;if(b=="Number"){c=parseFloat(d)}if(b=="String"){c=String(d)}if(b=="uint"){c=parseInt(d)}if(b=="Boolean"){if(d=="true"){c=true}if(d=="false"){c=false}}return c};this.setProperty=function(c,b,d,e){this.propertiesXML[c]=e;this.properties[c]=b};this.getProperty=function(b){return this.properties[b]};this.setStyle=function(b,d,c,e){this.stylesXML[b]=e;this.styles[b]=d};this.getStyleProperty=function(b){return this.styles[b]}}function ComponentXML(a){this.settingsXML=null;this.component=a;this.settings=new ComponentSettings();this.getComponent=function(){return this.component};this.applySettings=function(){try{if(this.component.NAME=="Page"){this.component.eid=this.settingsXML.attr("eid")}else{}if(this.component.NAME=="Page"){var j=this.settingsXML.attr("name");this.addPropSingle("pageName",j,"default");if(this.settingsXML.attr("master")!=null){var b=this.settingsXML.attr("master");this.addPropSingle("masterPage",b,"default")}if(this.settingsXML.attr("visible")!=null){var c=this.settingsXML.attr("visible");if(c=="false"){this.addPropSingle("navHide",true,"default")}}}else{var l=Number(this.settingsXML.attr("w"));var f=Number(this.settingsXML.attr("h"));var k=Number(this.settingsXML.attr("x"));var g=Number(this.settingsXML.attr("y"));if(this.settingsXML.attr("locked")!=null){var m=this.settingsXML.attr("locked");if(m=="true"){this.component.transformLock=true}}var n=new Object();n.width=l;n.height=f;this.addPropObject("esize",n,"default");var e=new Object();e.x=k;e.y=g;this.addPropObject("ecoordinates",e,"default")}var i=this;$(this.settingsXML).find("settings").each(function(){var h=$("<div/>").append($(this).clone());i.applyComponentSettings($(this))})}catch(d){alert(d)}};this.applyComponentSettings=function(c){try{var e="";var d=false;var b=this;$(c).find("property").each(function(){var m=$(this);var i=m.attr("name");var l=m.attr("type");var k=m.text();if(l=="Object"){var j=b.decodeObjectXML(m.find("object"));b.addPropObject(i,j,"default")}else{if(l=="Array"){var g=new Array();var h=m.find("array").attr("type");if(h=="Object"){$(m.find("array")).find("object").each(function(){g[g.length]=(decodeObjectXML($(this)))})}else{$(m.find("array")).find("val").each(function(){g[g.length]=(b.setType(h,$(this)))})}b.addPropArray(i,g,h,"default")}else{if(i!="editValue"){b.addPropSingle(i,b.setType(l,k),"default")}else{d=true;e=b.setType(l,k)}}}});$(c).find("style").each(function(){var j=$(this).attr("name");var k=$(this).attr("type");var i=$(this).text();if(k=="Array"){var l=new Array();var h=$(i);var g=h.attr("type");$(h).find("val").each(function(){l[l.length]=b.setType(g,$(this).text())});b.addStyleArray(j,l,g,"default")}else{b.addStyleSingle(j,b.setType(k,i),"default")}});if(d){b.addPropSingle("editValue",e,"default")}}catch(f){alert(f)}};this.decodeObjectXML=function(c){var b=this;var e=new Object();var d=0;$(c).find("prop").each(function(){var g=$(this).attr("name");var f=$(this).attr("type");e[g]=b.setType(f,$(this).text());d++});if(d==0){e=null}return e};this.setType=function(b,c){if(b=="Number"){return parseFloat(c)}if(b=="int"){return parseInt(c)}if(b=="Boolean"){if(c=="true"){return true}else{return false}}return c};this.getType=function(c){var b="String";if(typeof(c)=="int"){b="int"}if(typeof(c)=="number"){b="Number"}if(typeof(c)=="boolean"){b="Boolean"}return b};this.addPropSingle=function(e,g,c){c=typeof(c)!="undefined"?c:"true";var f=this.getType(g);var b='<property name="'+e+'" type="'+f+'">'+g+"</property>";var d=$(b);this.settings.setProperty(e,g,f,d)};this.addPropObject=function(f,h,c){c=typeof(c)!="undefined"?c:"true";var e=this.encodeObjectXML(h);var g="Object";var b='<property name="'+f+'" type="'+g+'">'+e+"</property>";var d=$(b);this.settings.setProperty(f,h,g,d)};this.addStyleSingle=function(e,b,c){c=typeof(c)!="undefined"?c:"true";var f=this.getType(b);var g='<style name="'+e+'" type="'+f+'">'+b+"</style>";var d=$(g);this.settings.setStyle(e,b,f,d)};this.addPropArray=function(j,d,l,k){k=typeof(k)!="undefined"?k:"true";var b="Array";var e='<array type="'+l+'">';if(l=="Object"){for(var h=0;h<d;h++){var c=d[h];e=e+encodeObjectXML(c)}}else{for(var h=0;h<d;h++){var f=d[h];e=e+"<val>"+String(f)+"</val>"}}e=e+"</array>";var g='<property name="'+j+'" type="'+b+'">'+e+"</property>";var m=$(g);this.settings.setStyle(j,d,b,m)};this.addStyleArray=function(d,l,h,g){g=typeof(g)!="undefined"?g:"true";var k="Array";var b='<array type="'+h+'">';for(var e=0;e<l;e++){var c=l[e];b=b+"<val>"+String(c)+"</val>"}b=b+"</array>";var j='<style name="'+d+'" type="'+k+'">'+b+"</style>";var f=$(j);this.settings.setStyle(d,l,k,f)};this.encodeObjectXML=function(e){var c="<object>";for(var d in e){if(d!="mx_internal_uid"){var b=this.getType(e[d]);c=c+'<prop type="'+b+'" name="'+d+'">'+e[d]+"</prop>"}}c=c+"</object>";return c}}function addLinkHiglights(){for(var c=0;c<=LINKED.length-1;c++){var b=LINKED[c];var a='<img src="assets/linklight.png" class="mfcomplinked" width="12" height="12" style="position:absolute; width:12px; height:12px; top:'+(b.y-6).toString()+"px; left:"+(b.x-6).toString()+'px; " > ';a=a+"</img>";$("#mockupContent").append(a)}}function addLink(b,a){if(a&&a!=""){$("#"+b).css("cursor","pointer");$("#"+b).click(function(){var d=PagePool.getPage(a);if(d){viewPage(d)}else{var c=a.split("::URL::");if(c.length==2){window.open(c[1])}}})}}function addSingleLink(a){var c=true;if(a.GROUPID!=""){var b=currentPage.linkedGroups[a.GROUPID];if(b!=null&&b!=""){c=false}}if(!a.ALLOW_MULTILINK){if(c){var b="";if(a.e2xml.settings.properties.pageLink!=null){b=a.e2xml.settings.properties.pageLink}if(b!=null&&b!=""){LINKED[LINKED.length]=a;$("#"+a.eid).css("cursor","pointer");$("#"+a.eid).click(function(){var e=PagePool.getPage(b);if(e){viewPage(e)}else{var d=b.split("::URL::");if(d.length==2){window.open(d[1])}}})}}}if(a.GROUPID!=""){var b=currentPage.linkedGroups[a.GROUPID];if(b!=null&&b!=""){$("#"+a.eid).css("cursor","pointer");$("#"+a.eid).click(function(){var e=PagePool.getPage(b);if(e){viewPage(e)}else{var d=b.split("::URL::");if(d.length==2){window.open(d[1])}}})}}}function Page(){this.NAME="Page";this.x=0;this.y=0;this.width=100;this.height=100;this.transformLock=false;this.eid="";this.e2xml=new ComponentXML(this);this.children=new Array();this.navHide=false;this.pageName="";this.folder=false;this.parentPage="";this.masterPage="";this.linkedGroups=new Object()};